var token="";$(function(){if(""===token){console.log("empty token");var e=Cookie.get();""===e?(console.log("opening login form"),$("#login-form").modal({backdrop:"static",keyboard:!1})):(token=e,App.start(token))}else App.start(token)});var App={start:function(){App.init()},init:function(){Global.registerHandlebarHelpers(),Template.showPlaces(),Template.init()&&$.each(Map.positions,function(e,t){var n=$(t.id+"-template"),r=$(t.id);n.length&&(t.autoload===!0?Data.get(t.template,null,n,r,null):Data.get(null,null,n,r,null))})}},Template={init:function(){var e=!1;return $("#templates").children().length?(console.log("template exists!"),e=!0):$.ajax({url:Map.templates,async:!1,success:function(t){$("#templates").append(t),e=!0}}),e},showPlaces:function(){$.each(Map.places,function(e,t){$(t).length&&$(t).removeClass("hide")})},compile:function(e,t,n){var r=t.html(),t=Handlebars.compile(r),i=t(e);n.html(i),Template.afterCompile(i)},afterCompile:function(e){-1!==e.indexOf('"nano')&&$(".nano").nanoScroller({flash:!0,preventPageScrolling:!0,tabIndex:0})}},Data={get:function(e,t,n,r){if("undefined"!=typeof e&&""!==e&&e){console.log(e);var i=Map.positions[e].service;$.ajax({url:Map.serviceBase+i,headers:{Authorization:token},success:function(e){var t=JSON.parse(e);Template.compile(t,n,r)}})}else t=[],Template.compile(t,n,r)},post:function(){return!1},put:function(){return!1}},Location={goBack:function(){Location.redirect(!0)},redirect:function(e){return"undefined"==typeof e?!1:(window.location.href=e,!0)},refresh:function(){location.reload()}},Global={isInt:function(e){return"number"==typeof parseInt(e)&&isFinite(parseInt(e))&&parseInt(e)%1===0},getVal:function(e,t,n){if(e.length){var r=e.attr(t);return"undefined"==typeof r&&(r=n),r}return!1},ucfirst:function(e){return"undefined"!=typeof e?e.charAt(0).toUpperCase()+e.slice(1):e},cleanText:function(e){return e.replace(/[^a-zA-Z\u0600-\u06FF\s]/gi,"")},registerHandlebarHelpers:function(){Handlebars.registerHelper("times",function(e,t){for(var n="",r=0;e>r;++r)n+=t.fn(r);return n}),Handlebars.registerHelper("date",function(e){var t="";("undefined"==typeof e||""===e)&&(e=0);var n=new Date;n.setDate(n.getDate()+e);var r=n.getDate(),i=n.getMonth()+1,o=n.getFullYear();return 10>r&&(r="0"+r),10>i&&(i="0"+i),t=i+"/"+r+"/"+o}),Handlebars.registerHelper("date2",function(e){var t="";("undefined"==typeof e||""===e)&&(e=0);var n=new Date;n.setDate(n.getDate()+e);var r=n.getDate(),i=n.getMonth()+1,o=n.getFullYear();return 10>r&&(r="0"+r),10>i&&(i="0"+i),t=o+"-"+i+"-"+r}),Handlebars.registerHelper("htimes",function(e,t){for(var n="",r=1;e+1>r;++r)n+=t.fn(r);return n}),Handlebars.registerHelper("for",function(e,t,n,r){for(var i="",o=e;t>o;o+=n)i+=r.fn(o);return i}),Handlebars.registerHelper("ifCond",function(e,t,n){return e===t?n.fn(this):n.inverse(this)}),Handlebars.registerHelper("ifActive",function(e){var t="undefined"==typeof Location.parts[2]?0:Location.parts[2];return parseInt(e)===parseInt(t)?"grey-cascade":"btn-default"}),Handlebars.registerHelper("cycle",function(e,t){var n=e.split(" ");return n[t.data.index%(n.length+1)]}),window.Handlebars.registerHelper("select",function(e,t){var n=$("<select />").html(t.fn(this));return n.find("[value="+e+"]").attr({selected:"selected"}),n.html()})}},Map={templates:"data/templates.html",serviceBase:"http://localhost:91/Assignment.svc/",places:[".wrapper"],services:{},login:{service:"login"},positions:{userparams:{id:"#userparams",template:"userparams",service:"UserParams",autoload:!0},search:{id:"#search",template:"search",autoload:!1},results:{id:"#results",template:"results",service:"AssignmentItemGetAll",autoload:!0},conversation:{id:"#conversation",template:"conversation",service:"AssignmentItemDetGetAll/{id}",autoload:!1}}},Cookie={lifetime:600,title:"newsroom=",init:function(){},check:function(e){if("undefined"==typeof e)var e=Cookie.title;return Cookie.get(Cookie.title)},parse:function(e){return"undefined"!=typeof e?e:!1},"delete":function(e){if("undefined"==typeof e)var e=Cookie.title;var t="Thu, 01 Jan 1970 00:00:01 GMT";document.cookie=e+"; "+t+"; path=/"},set:function(e,t){if("undefined"==typeof e)var e=Cookie.title;var e=Cookie.title,n=new Date;n.setTime(n.getTime()+1e3*Cookie.lifetime);var r="expires="+n.toGMTString();return document.cookie=e+t+"; "+r+"; path=/",t},get:function(e){if("undefined"==typeof e)var e=Cookie.title;for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var r=t[n].trim();if(0===r.indexOf(e))return Cookie.parse(r.substring(e.length,r.length))}return""}};$(document).on("click","#login-anchor",function(e){var t=!1;return $.ajax({url:Map.serviceBase+Map.login.service,data:$("#login-form form:first").serialize(),type:"post",success:function(e){""!==e?(token=e,$("#login-form").find(".alert").addClass("hide"),$("#login-form").modal("hide"),Cookie.set(Cookie.title,e),App.start(t)):$("#login-form").find(".alert").slideDown(function(){$("#login-form").find(".alert").removeClass("hide")})}}),e.preventDefault(),!1}).on("focusin","#login-form form:first",function(){$("#login-form").find(".alert").slideUp(function(){$("#login-form").find(".alert").addClass("hide")})});
